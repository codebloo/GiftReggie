<div class="manage-registry-header">
    <div class="container">
		<div class="row no-gutters manage-registry-layout">
			{% if image %}
			<div class="col-12 col-lg-3">
				<div class="manage-registry-photo" style="background-image:url({{ image }});">
				<img src='{{ image }}' alt="{{ registrant | escape_html }}{% if coregistrant %} & {{ coregistrant | escape_html }}{% else %}{{ 'gift-reggie.terms.none' | t }}{% endif %}'s Photo"/>
			</div>
			</div>
			{% endif %}	
			<div class="{% if image %}col-12 col-lg-7{% else %}col-12 col-lg-8 offset-lg-2{% endif %}">
					<div class="registry-header-details">
						<h2 class="registry-title">{{ registrant | escape_html }}{% if coregistrant %} & {{ coregistrant | escape_html }}{% else %}{{ 'gift-reggie.terms.none' | t }}{% endif %}'s Registry</h2>
						
						<div class="registry-title-event-date">Wedding Details: {{ event_datetime | date }}</div>
					
						
						{% if message %}
							<div class="giftreggie-store-message registry-title-event-message">{{ message | escape_html | newline_to_br }}</div>
						{% endif %}
						{% if description %}
							<div class="giftreggie-description registry-title-event-message">
								{{ description | escape_html | newline_to_br }}
							</div>
						{% endif %}
						<div class="giftreggie-edit-description">
							<button>{{ 'gift-reggie.registry.edit_message' | t }}</button>
						</div>
				
				
						
						<div class="registry-title-url">
							<label class="registry-title-link-label">Registry Link:</label> 
							<span>https://{{ shop.domain }}{{ proxy_url }}/registry/{{ id }}</span>
						</div>
					</div>
				</div>
		</div>
	</div>
</div>


{% if products.size == 0 %}
	<div class="giftreggie-no-products">{{ 'gift-reggie.wishlist.no_products' | t }} {% if is_admin %}<a href='{{ browsing_link }}'>Start by Adding Gifts</a>{% endif %}</div>
{% endif %}




{% if is_admin %}

	{%- comment -%}
	Code for displaying product table
	Each product is a row containing 
	Line Item | Product Title | Image | Price | Wants | Has| Needs | Quantity Selector
	At the bottom of the table are update cart and checkout buttons
	{%- endcomment -%}
	{% if products.size > 0 %}
		{% if max_pages > 1 %}
		{%- comment -%}Pagination options{%- endcomment -%}
			<div class="giftreggie-items-page">
				{{ 'gift-reggie.items_per_page' | t }}
				<select id="per-page-selector">
					<option>25</option>
					<option>50</option>
					<option>100</option>
				</select>
			</div>
		{% endif %}
		<form method="post" class="giftreggie-registry-form">
			<input type='hidden' name='extra' value='{{ extra | escape_html }}'/>
			<table class="giftreggie-desktop giftreggie-view-registry" id="view-registry">
				<tr>
					<th>{{ 'gift-reggie.terms.line' | t }}</th>
					<th>{{ 'gift-reggie.terms.product_title' | t }}</th>
					<th>{{ 'gift-reggie.terms.product_image' | t }}</th>
					<th>{{ 'gift-reggie.terms.product_price' | t }}</th>
					<th>{{ 'gift-reggie.registry.wants' | t }}</th>
					<th>{{ 'gift-reggie.registry.has' | t }}</th>
					<th>{{ 'gift-reggie.registry.needs' | t }}</th>
					<th>{{ 'gift-reggie.terms.delete' | t }}
					</th>
				</tr>
				{% for product in products %}
					<input type='hidden' name="item-id" value="{{ product.id }}">
					<tr class="registry-variant">
						<td><input type='text' class="giftreggie-line-number" name='position-{{ product.id }}' value='{{ product.line_number }}' maxlength=3 size=3 style="width: auto!important"/>
						</td>
						<td>
							{% if product.still_needs > 0 %}
								<a class="giftreggie-item-name" href='{% if testing %}/mock{% endif %}/products/{{ product.handle | escape_html }}?variant={{ product.variant_id }}'>{{ product.title | escape_html }}</a>
							{% else %}
								<span class="giftreggie-item-name">{{ product.title | escape_html }}</span>
							{% endif %}
							{% if product.properties %}
								<div class="properties">
									{% assign bold_price = 0 %}
									{% for property in product.properties %}
										{% if property.name contains '_boldVariantPrices' %}
											{% assign bold_price = property.value %}
										{% endif %}
										{% if property.name contains 'bold' %}
											<div style='display: none' class="property property-{{ property.name | handleize }}">
												<span class="property-name">{{ property.name | escape_html }}</span>
												<span class="property-value">{{ property.value | escape_html }}</span>
											</div>
										{% else %}
											<div class="property property-{{ property.name | handleize }}">
												<span class="property-name">{{ property.name | escape_html }}</span>
												<span class="property-value">{{ property.value | escape_html }}</span>
											</div>
										{% endif %}
									{% endfor %}
								</div>
							{% endif %}
						</td>
						<td><img src='{{ product.image | img_url: "128x128" }}'/></td>
						<td><span class='money'>{{ (product.price + bold_price) | money }}</span></td>
						<td><input type='text' class="giftreggie-want-quantity" name="want-quantity-{{ product.id }}" maxlength=4 size=3 value='{{ product.wants }}' style="width: auto!important"/>
						</td>
						<td>{{ product.has }}</td>
						<td class="giftreggie-needs-quantity">{{ product.still_needs }}</td>
						<input type='hidden' class='variant-id' name='variant-id' value='{{ product.variant_id }}'/>
						<input type='hidden' class='product-id' name='product-id' value='{{ product.product_id }}'/>
						<td>
							<!-- If we have a 'has' quantity associated with this, remove the option to remove the item, but keep it available in the back-end for those special cases. -->
							{% if product.has %}
								&nbsp;
							{% else %}
								<button name='action' value="delete-{{ product.id }}">&times;</button>
							{% endif %}
						</td>
					</tr>
				{% endfor %}
			</table>
			{%- comment -%}
			Code for mobile version of product table
			Does not display as a table, but rather as a 1xY grid of products, where Y is the number of products
			{%- endcomment -%}	
		<ul class="giftreggie-mobile giftreggie-view-registry">
			{% for product in products %}
				<li class='registry-variant'>
					<input type='hidden' name="item-id" value="{{ product.id }}">
					<input type='hidden' class='variant-id' name='variant-id' value='{{ product.variant_id }}'/>
					<input type='hidden' class='product-id' name='product-id' value='{{ product.product_id }}'/>
					<p class="giftreggie-item-image"><a href='{% if testing %}/mock{% endif %}/products/{{ product.handle | escape_html }}'><img src='{{ product.image }}'/></a></p>
					<p>
						<a class="giftreggie-item-name" href='{% if testing %}/mock{% endif %}/products/{{ product.handle | escape_html }}'>{{ product.title | escape_html }}</a>
						
						{% if product.properties %}
							<div class="properties">
							    {% assign bold_price = 0 %}
								{% for property in product.properties %}
								 {% if property.name is '_boldVariantPrices' %}
								    {% assign bold_price = property.value %}
								 {% endif %}
								 {% if property.name contains 'bold' %}
								        <div style='display: none' class="property property-{{ property.name | handleize }}">
    										<span class="property-name">{{ property.name | escape_html }}</span>
    										<span class="property-value">{{ property.value | escape_html }}</span>
    									</div>
								    {% else %}
    									<div class="property property-{{ property.name | handleize }}">
    										<span class="property-name">{{ property.name | escape_html }}</span>
    										<span class="property-value">{{ property.value | escape_html }}</span>
    									</div>
									{% endif %}
								{% endfor %}
							</div>
						{% endif %}
					</p>
					<p>
						<span class='money'>{{ (product.price + bold_price) | money }}</span>
					</p>
					<p>
						<table>
							<tr>
								<th>{{ 'gift-reggie.registry.wants' | t }}</th><td><input type='text' class="giftreggie-want-quantity" name="want-quantity-{{ product.id }}" maxlength=3 size=3 value='{{ product.wants }}'/></td>
								<th>{{ 'gift-reggie.registry.has' | t }}</th><td>{{ product.has }}</td>
								<th>{{ 'gift-reggie.registry.needs' | t }}</th><td class="giftreggie-needs-quantity">{{ product.still_needs }}</td>
							</tr>
						</table>
					</p>
				</li>
			{% endfor %}
		</ul>
			<div class="action-buttons">
				<span><button id='discard-changes'>{{ 'gift-reggie.terms.discard_changes' | t }}</button></span>
				<span><button id='save-changes' name='action' value='update'>{{ 'gift-reggie.terms.save_changes' | t }}</button></span>
			</div>
			{%- comment -%}Script for handling these discard/save- changes buttons{%- endcomment -%}
			<script type='text/javascript'>
				window.jqReady.push(function(jQuery) {
					(function($) {
						$('#view-registry input').keypress(function (e) {
							if (e.which == 13) {
								$('#save-changes').click();
								return false;
							}
						});
						$('#discard-changes').click(function() {
							window.location.href = window.location.href;
							return false;
						});
					})(jQuery);
				});
			</script>
			{% if max_pages > 1 %}
				<div id="pagination-div"></div>
			{% endif %}
			<div id="status-bar" style="display:none;">{{ 'gift-reggie.cart-update.success' | t }}</div>
		</form>
		{%- comment -%}Include code from annother GR template{%- endcomment -%}
		{% include 'proxy_cart_update' %}
		<p class='giftreggie-browse-add-products'><a href='{{ browsing_link }}'>{{ 'gift-reggie.registry.browsing' | t }}</a></p>
	{% endif %}
{%- comment -%}
If not admin, use the "pretty" grid layout instead of table layout.
{%- endcomment -%}
{% else %}
	{%- comment -%} Code for top banner image {%- endcomment -%}
	<div class="giftreggie-hero-image"> 
		<div class="giftreggie-hero-text">
			<h1 class="giftreggie-registry-title">{{ name | escape_html }}</h2>
			<h2>{{ event_datetime | date }}</h2>
			{% if message %} <div class="giftreggie-store-message">{{ message | escape_html | newline_to_br }}</div>{% endif %}
			{% if description %}<div class="giftreggie-description">{{ description | escape_html | newline_to_br }}</div>{% endif %}
		</div>
	</div>

	{%- comment -%} Code for product grid {%- endcomment -%}
	{% if products.size > 0 %}
		{%- comment -%}Pagination{%- endcomment -%}
		{% if max_pages > 1 %}
			<div class="giftreggie-items-page">
			{{ 'gift-reggie.items_per_page' | t }}
				<select id="per-page-selector">
					<option>25</option>
					<option>50</option>
					<option>100</option>
				</select>
			</div>
		{% endif %}
		<div class="giftreggie-grid-container">
			{% for product in products %}
				<div class="giftreggie-product-container">
					{%- comment -%}
					This tile represents the product image and info, but not the add to cart button
					Clicking this tile directs to product page
					{%- endcomment -%}
					<a class="giftreggie-product-link" href="{% if testing %}/mock{% endif %}/products/{{ product.handle | escape_html }}?variant={{ product.variant_id }}">
					<div class="giftreggie-product-tile">

						{%- comment -%}This container holds the product image, cropped to a square aspect ratio{%- endcomment -%}
						<div class="giftreggie-product-image-container">
							<img src='{{ product.image | img_url: "300x300"}}' alt="">
						</div>

						{%- comment -%}This container holds the product's name, variant, price, and "wants/still needs" information{%- endcomment -%}
						<div class="giftreggie-product-description-container">
							<div class="giftreggie-product-name-wrapper">
								{% assign full_title = product.title | split: ' - '%}
								<p class="giftreggie-product-name">{{ full_title[0] }}</p>
								<p class="giftreggie-product-variant-name"> 
								{%- comment -%}Display just the varriant name without product name{%- endcomment -%}
									{% for title in full_title %}
										{% if title != full_title[0] %}
											{{ title }}
										{% endif %}
									{% endfor %}
                                    {% if product.properties %}
                                    <div class="properties">
                                        {% assign bold_price = 0 %}
                                        {% for property in product.properties %}
                                            {% if property.name contains '_boldVariantPrices' %}
                                                {% assign bold_price = property.value %}
                                            {% endif %}
                                            {% if property.name contains 'bold' %}
                                                <div style='display: none' class="property property-{{ property.name | handleize }}">
                                                    <span class="property-name">{{ property.name | escape_html }}</span>
                                                    <span class="property-value">{{ property.value | escape_html }}</span>
                                                </div>
                                            {% else %}
                                                <div class="property property-{{ property.name | handleize }}">
                                                    <span class="property-name">{{ property.name | escape_html }}</span>
                                                    <span class="property-value">{{ property.value | escape_html }}</span>
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
						            {% endif %}
								</p>
							</div>
							<div class="giftreggie-product-price-container">
								<p class="giftreggie-product-price">{{product.price | money}}</p>
							</div>
							<div class="giftreggie-wants-needs-container">
								{% if product.still_needs > 0 %}
									Requested: {{product.wants}} ·
									Still Needs: {{product.still_needs}}
								{% endif %}
							</div>
						</div>
					</div>
					</a>

					{%- comment -%}This container holds the add to cart button and quantity input{%- endcomment -%}
					<div class="giftreggie-product-cart-modifier-container">
						<form method="post" class="giftreggie-registry-form">
							{%- comment -%}Pass product identification information to form as hidden inputs{%- endcomment -%}
							<input type='hidden' name="item-id" value="{{ product.id }}">
							<input type='hidden' class='variant-id' name='variant-id' value='{{ product.variant_id }}'/>
							<input type='hidden' class='product-id' name='product-id' value='{{ product.product_id }}'/>
							{% if product.still_needs < 1 %}
								<span class="giftreggie-product-cart-message"> ✓ Purchased </span>
							{% elsif product.inventory_quantity < 1 %}
								<span class="giftreggie-product-cart-message"> Sold Out </span>
							{% else %} {%- comment -%} If product not sold out and still is needed, display buttons{%- endcomment -%}

								{%- comment -%}
								Assign each quantity input a unique id tied to specific product variant
								This way we can find that specific quantity when we add it to cart
								{%- endcomment -%}
								{% assign quantity_id = product.variant_id | prepend: 'registry-variant-quantity-' %}
								<input type='number' class='giftreggie-registry-variant-quantity' maxlength=3 id='{{ quantity_id }}' value="1" min="1" max="{{ product.still_needs }}"/>

								<button class="giftreggie-add-to-cart btn">{{ 'gift-reggie.cart-update.add' | t }}</button>
							{% endif %}
						</form>
					</div>
				</div>
			{% endfor %}
		</div>
	{% endif %}

	<style>
		.giftreggie-hero-image {
			{% if image %}
				background-image: radial-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)), url({{ image }});
			{% else %}
				background-color: #444
			{% endif %}
			height: 300px;
			background-position: center;
			background-repeat: no-repeat;
			background-size: cover;
			position: relative;
			margin-bottom: 50px;
		}
		.giftreggie-hero-text {
			text-align: center;
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);

			color: white!important;
		}
		.giftreggie-description {
			overflow: auto;
			height: 150px;
			/* Hide scrollbar for IE, Edge and Firefox */
			-ms-overflow-style: none;  /* IE and Edge */
  			scrollbar-width: none;  /* Firefox */
		}
		/* Hide scrollbar for Chrome, Safari and Opera */
		.giftreggie-description::-webkit-scrollbar {
			display: none;
		}
        .properties{
            color: grey;
            font-size: 1.45vh;
        }
		.giftreggie-grid-container {
			/* Grid cells are 250x500px */
			display: grid;
			grid-auto-rows: 500px 500px;
			justify-content: center;
			grid-gap: 10px;
		}
		.giftreggie-product-container {
			width: 98%;
			height: 98%;
			position:relative;
			box-sizing: border-box;
			text-align: left;
			border: 1px solid #EEE;
		}
		.giftreggie-product-tile{
			/* Product tile is 90% and add to cart button is 10% */
			height: 90%;
		}
		.giftreggie-product-container:hover {
			box-shadow: 0px 0px 5px 2px #AAA;
		}
		.giftreggie-product-cart-message{
			font-size: larger;
			font-weight: bold;
		}
		.giftreggie-product-cart-modifier-container{
			width: 100%;
			/* Product tile is 90% and add to cart button is 10% */
			height: 10%; 
			display: inline-block;
			text-indent: 5px;
			text-align: center;
			position: relative;
			bottom: 0;
			left: 0;
		}
		.giftreggie-wants-needs-container {
			text-align: center;
			font-size: smaller;
			position: absolute;
			bottom: 0;
			left: 0;
			right: 0;
		}
		.giftreggie-registry-variant-quantity {
			margin-left: 5px; 
		}
		.giftreggie-product-cart-modifier-container button{
			margin: 0px!important;
		}
		.giftreggie-product-description-container{
			margin-left: 5px;
			margin-right: 5px;
			position: relative;
			height: 45%;
		}
		input.giftreggie-registry-variant-quantity{
			float: left;
			width: 25%;
		}
		button#registry-update-cart{
			float: left;
		}
		.giftreggie-product-image-container {
			width: 100%;
			height: 50%;
			position: relative;
			border-bottom: 1px solid #EEE;
		}
		.giftreggie-product-image-container img {
			width: 100%;
			height: 100%;	   
			object-fit: cover;
		}
		@media screen and (max-width: 524px) {
			.giftreggie-hero-image {
				/* Format hero image to take entire width of screen on smaller devices */
				width: 100vw;
				margin-left: calc(50% - 50vw);
			}
			.giftreggie-grid-container {
				/* reduce number of columns depending on screen size */
				grid-template-columns: repeat(1, 250px);
			}		
		}
		@media screen and (min-width: 525px) and (max-width: 768px) {
			.giftreggie-hero-image {
				width: 100vw;
				margin-left: calc(50% - 50vw);
			}
			.giftreggie-grid-container {
				grid-template-columns: repeat(2, 250px);
			}		
		}
		@media screen and (min-width: 769px) and (max-width: 1280px) {
			.giftreggie-hero-image {
				width: 100vw;
				margin-left: calc(50% - 50vw);
			}
			.giftreggie-grid-container {
				grid-template-columns: repeat(3, 250px);
			}		
		}
		@media screen and (min-width: 1281px) and (max-width: 1919px) {
			.giftreggie-hero-image {
				/* on large devices, hero banner does not stretch the entire screen */
				width: 100%;
			}
			.giftreggie-grid-container {
				grid-template-columns: repeat(4, 250px);
			}		
		}
		@media screen and (min-width: 1920px) {
			.giftreggie-hero-image {
				width: 100%;
			}
			.giftreggie-grid-container {
				grid-template-columns: repeat(5, 250px);
			}		
		}
	</style>
{% endif %}

<script type='text/javascript'>	
	window.jqReady.push(function(jQuery) {		
		(function( $ ) {
			createPagination($('#pagination-div'), {{ max_pages }});

			$('#per-page-selector').change(function() {
				var url = window.location.href.replace(/[\?\&](limit|page)=\d+/g, "").replace(/^([^\?])+&/, "$1\?");
				url += (url.indexOf("?") == -1) ? "?" : "&";
				window.location = url + "limit=" + $(this).val();
			});
				
			var vars = getUrlVars();
			if (vars['limit']) 
				$('#per-page-selector').val(vars['limit']);

			//when "Add to cart" is clicked, this adds to cart	
			$('.giftreggie-add-to-cart').click(function() {
				var variantRow = $(this).parents(".giftreggie-product-container").first();
				var id = variantRow.find(".variant-id").val();

				var prop_names = variantRow.find('.property-name');
				var prop_values = variantRow.find('.property-value');
				var quantityID = 'registry-variant-quantity-' + id; 
				var quantity = document.getElementById(quantityID).value; //finds the specific product variant we want and gets the quantity
				var properties = "";
				for(i = 0; i < prop_names.length; ++i){
					properties = properties + '<input name="properties[' + prop_names[i].textContent + ']" value="' + prop_values[i].textContent + '">'
				}
                console.log(properties);
				$('<form method="post" action="/cart/add"><input type="hidden" name="id" value="' + id + '"/><input type="hidden" name="quantity" value="' + quantity + '"/>' + properties + '</form>').appendTo("body").submit();
				return false;
			});
				
			$('.giftreggie-registry-form').submit(function() {
				$('.giftreggie-view-registry').each(function() {
					var div = $(this);
					if (!div.is(":visible")) {
						div.find("input").remove();
					}
				});
			});
		})(jQuery);
	});
</script>
